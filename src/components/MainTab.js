import React,{Component} from 'react';
import {
  View,
  Text,
  FlatList,
  Modal,
  TouchableHighlight,
} from 'react-native'
import {TabNavigator} from 'react-navigation'

import MissionItem from './missionItem'

import { connect } from 'react-redux';
import {clearMission,creatMission,readMission,addMission} from '../action/missions';



class MainTab extends Component {
  static navigationOptions = {
    tabBarLabel: 'Main',
  };

  state = {
    modalVisible: false,
    key:0,
  }

  setModalVisible(index) {
    this.setState({modalVisible: !this.state.modalVisible,key:index});
  }

  render() {
    const {missions}=this.props;
    //const filled=missions.filter((data)=>{return (data.importance==0)});
    const filled=missions;
    return (
      <View>
        <Modal
          animationType={"slide"}
          transparent={true}
          visible={this.state.modalVisible}
          onRequestClose={() => {alert("Modal has been closed.")}}
          >
         <View style={{backgroundColor: 'rgba(0,0,0,0)', justifyContent: 'center',alignItems: 'center',margin: 40}}>
          <View style={{justifyContent: 'center',alignItems: 'center',width: 200, height: 100,marginTop: 22, backgroundColor: 'rgba(255,255,255,105)'}}>
            <Text>No.{this.state.key}</Text>

            <TouchableHighlight onPress={() => {
              this.props.clearMission(this.state.key);
              this.setModalVisible(!this.state.modalVisible)
            }}>
              <Text>Hide Modal</Text>
            </TouchableHighlight>

          </View>
         </View>
        </Modal>
        <FlatList
          data={filled}
          renderItem={({item}) => {return <MissionItem data={item} onPress={()=>this.setModalVisible(item.key)}/>}}
        />
        <TouchableHighlight onPress={() => {
          this.setModalVisible(0)
        }}>
          <Text>Show Modal</Text>
        </TouchableHighlight>
        <TouchableHighlight onPress={() => {
          this.props.creatMission()
        }}>
          <Text>creatMission</Text>
        </TouchableHighlight><TouchableHighlight onPress={() => {
          this.props.readMission()
        }}>
          <Text>readMission</Text>
        </TouchableHighlight>
        <TouchableHighlight onPress={() => {
          this.props.addMission()
        }}>
          <Text>addMission</Text>
        </TouchableHighlight>
      </View>
    );
  }
}

function mapStateToProps(state) {
  console.log(state);
  return {
    missions: state.missionsReducer.missions,
  };
}

function mapDispatchToProps(dispatch) {
  return {
    creatMission: () => dispatch(creatMission()),
    readMission: () => dispatch(readMission()),
    addMission: () => dispatch(addMission()),
    clearMission: (key) => dispatch(clearMission(key)),
  };
}

export default connect(
  mapStateToProps,
  mapDispatchToProps,
)(MainTab);
